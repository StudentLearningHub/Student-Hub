<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Student Hub (Legacy Working Version)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: Arial, sans-serif; background:#f5f7ff; margin:0; }
#app { max-width:900px; margin:2rem auto; background:#fff; padding:1.5rem; border-radius:8px; box-shadow:0 4px 10px rgba(0,0,0,.1); }
input, button { padding:.6rem; margin:.25rem 0; width:100%; }
button { background:#4f46e5; color:#fff; border:none; border-radius:4px; cursor:pointer; }
button.secondary { background:#e5e7eb; color:#111; }
.chat-box { border:1px solid #ddd; height:300px; overflow-y:auto; padding:.5rem; margin-bottom:.5rem; }
.msg { margin-bottom:.25rem; }
.msg span { font-weight:bold; }
</style>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
</head>
<body>
<div id="app">Loadingâ€¦</div>

<script>
// ðŸ”¹ VERY SIMPLE LEGACY VERSION â€” THIS ONE IS HARD TO BREAK

const firebaseConfig = {
  apiKey: "AIzaSyCfijY0V4DQDOkrb13ludHiGRFtWsk8Bsg",
  authDomain: "student-hub-450ab.firebaseapp.com",
  databaseURL: "https://student-hub-450ab-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "student-hub-450ab",
  storageBucket: "student-hub-450ab.firebasestorage.app",
  messagingSenderId: "149361370872",
  appId: "1:149361370872:web:e3ee75310e59d92f3bbd0d"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

let user = null;

function renderLogin() {
  document.getElementById('app').innerHTML = `
    <h2>Student Hub</h2>
    <input id="email" placeholder="Email">
    <input id="password" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <button class="secondary" onclick="guest()">Continue as Guest</button>
  `;
}

function renderChat() {
  document.getElementById('app').innerHTML = `
    <h2>General Chat</h2>
    <div class="chat-box" id="chat"></div>
    <input id="msg" placeholder="Type messageâ€¦">
    <button onclick="sendMsg()">Send</button>
    <button class="secondary" onclick="logout()">Logout</button>
  `;

  db.ref('chat').limitToLast(100).on('child_added', snap => {
    const m = snap.val();
    const div = document.createElement('div');
    div.className = 'msg';
    div.innerHTML = `<span>${m.name}:</span> ${m.text}`;
    document.getElementById('chat').appendChild(div);
  });
}

function login() {
  auth.signInWithEmailAndPassword(
    document.getElementById('email').value,
    document.getElementById('password').value
  );
}

function guest() {
  user = { uid: 'guest-' + Date.now(), name: 'Guest' };
  renderChat();
}

function logout() {
  auth.signOut();
}

function sendMsg() {
  const text = document.getElementById('msg').value;
  if (!text) return;
  db.ref('chat').push({
    name: user.displayName || user.name || 'Guest',
    text,
    time: Date.now()
  });
  document.getElementById('msg').value = '';
}

auth.onAuthStateChanged(u => {
  if (u) {
    user = u;
    renderChat();
  } else {
    renderLogin();
  }
});
</script>
</body>
</html>